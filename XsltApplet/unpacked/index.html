<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
    <title>XsltApplet</title>
    <script src='www/jquery.js' type='text/javascript'></script>
    <script src='www/jquery-ui.js' type='text/javascript'></script>
    <link href="www/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script>
var APPLET_FAILED = 'Applet failed to load. Please check your security settings in "Java Control Panel".'
var popupWindow = null
var inputs = ['xml','xsl']
$(document).ready(function(){
    init()
    //update()
    if (typeof console !== 'undefined'){ console.log('loaded.') }
})
function update(){
    var xml = $('#xml').val(), xsl = $('#xsl').val()
    var result = typeof(document.XsltApplet.transform) !== 'undefined' ? document.XsltApplet.transform(xml, xsl) : APPLET_FAILED
    var errors = typeof(document.XsltApplet.getErrorMessages) !== 'undefined' ? document.XsltApplet.getErrorMessages() : APPLET_FAILED
    $('#result').val(result)
    $('#errors').val(errors)
    showWindow(result)
}
function showWindow(result){
    if (popupWindow == null || popupWindow.closed){
        popupWindow = window.open("","_blank","width=600,height=400,location=no,menubar=yes,resizable=yes,scrollbars=yes,status=yes,titlebar=yes")
        popupWindow.document.write(result)
        popupWindow.document.close()
        $(popupWindow).on('beforeunload', function(){
            $('#renderInWindow input').prop('checked', false)
        });
    } else {
        popupWindow.document.body.innerHTML = result;
    }
}
function hideWindow(){
    popupWindow.close()
}
function saveContent(){
    if (localStorage){
        for (var i = 0; i < inputs.length; i++){
            localStorage[inputs[i]] = $('#' + inputs[i]).val()
        }
    }
}
function loadContent(){
    if (localStorage){
        for (var i = 0; i < inputs.length; i++){
            $('#' + inputs[i]).val(localStorage[inputs[i]])
        }
    }
}
function init(){
    $('#xml').val('<a><b>test</b></a>')
    $('#xsl').get(0).value = ("<xsl:stylesheet version='2.0' xmlns:xsl='http://www.w3.org/1999/XSL/Transform'>\r\n" +
            "    <xsl:output method='xml' version='1.0' encoding='utf-8' indent='yes'/>\r\n" +
            "    <xsl:template match='/'>\r\n" +
            "        <b><xsl:value-of select='//b' /></b>\r\n" +
            "    </xsl:template>\r\n" +
            "</xsl:stylesheet>")
    var timer = new DelayedTimer( update )
    $('#xml,#xsl').keyup( timer.start )
    $('#version').html( typeof(document.XsltApplet.version) !== 'undefined' ? document.XsltApplet.version() : APPLET_FAILED)
    $('table tr:nth-child(3) td:first-child,table tr:nth-child(5) td:first-child').resizable({handles:'se,s,e', minWidth:100, minHeight:100})
    $('#renderInWindow input').click(function(evt){
        if($(this).is(':checked')){
            update() // -> showWindow()
        } else {
            hideWindow()
        }
    })
}
function DelayedTimer(callback, delay) {
    delay = delay || 300
    this.callback = callback
    this.ref = null
    this.start = function(){
        clearInterval(DelayedTimer.ref)
        DelayedTimer.ref = setTimeout(callback, delay)
    }
}
    </script>
    <style>
* {padding:0px;margin:0px;}
html,body{height:100%;width:100%;}
table,tr,td,th{border:1px solid grey;}
table{width:100%;height:100%;}
th{text-transform:capitalize;text-align:center;background:lightgray;height:1%;line-height:30px;}
#xml,#xsl,#result,#errors{width:100%;height:100%;overflow:auto;display:block;}
#renderInWindow{float:right;margin:4px 4px 0px 0px;font-weight:normal;}
    </style>
</head>
<body>
    <table>
        <tr>
            <th colspan="2">Version: <span id='version'>-</span></th>
        </tr>
        <tr>
            <th>xml</th>
            <th>xsl</th>
        </tr>
        <tr>
            <td><textarea id='xml'></textarea></td>
            <td><textarea id='xsl'></textarea></td>
        </tr>
        <tr>
            <th><span id='renderInWindow'><label>render in window: </label><input type='checkbox' /></span>result</th>
            <th>errors</th>
        </tr>
        <tr>
            <td><textarea id='result'></textarea></td>
            <td><textarea id='errors'></textarea></td>
        </tr>
    </table>
    <applet name='XsltApplet' code="XsltApplet.class" archive='libs/XsltApplet-1.0.jar?version=1394456757053' width='0' height='0'></applet>
</body>
</html>