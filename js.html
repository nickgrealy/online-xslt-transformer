<!DOCTYPE html><html><head>
<link rel="stylesheet" type="text/css" href="cssreset-min.css">
<link rel="stylesheet" type="text/css" href="editor.css">
<script src="jquery-ui-1.9.2.custom/js/jquery-1.8.3.min.js"></script><script>
// Static Config
var jqueryUrls = [
    'http://code.jquery.com/jquery.min.js',
    'jquery-ui-1.9.2.custom/js/jquery-1.8.3.min.js',
    'http://online-xslt-transformer.googlecode.com/svn/trunk/jquery-ui-1.9.2.custom/js/jquery-1.8.3.min.js'];
var jqueryUrlIndex = 1;
var frameNames = ['html','css','js', 'target']
var targetFrameIndex = 3;
// Variables
var frameMap = {};
var taMap = {};
$(document).ready(function(){
    init();
});
function init(){
    // build frames and textareas...
	var fs = $('<frameset>').attr('cols','50%,50%').attr('rows','50%,50%');
	$('body').append(fs);
	$.each(frameNames, function(index,frame){
	    var f = $("<frame>").attr("id",frame);
	    fs.append(f);
	    frameMap[frame] = f[0].contentWindow.document;
	    if (index != targetFrameIndex){
		    taMap[frame] = buildFrame(frame);
	    }
	});
	// provide some example data...
	taMap['html'].val('<b><i>Bold italics</i></b><br/>\n'
        +'<input id="button" type="button" value="Foobar" />\n'
        +'<div id="test">abc</div>\n');
	taMap['css'].val('b{color:blue;}\n'
        +'i{text-decoration:underline;}\n');
	taMap['js'].val('var foobar = function() { alert("hello"); };\n'
        +'$("#button").click(function(){\n'
        +'foobar();\n'
        +'});\n'
        +'$("#test").css("border","3px solid red");\n');
    //taMap['html'].focus();
	render();
}
// code to build the contents of the frame
function buildFrame(id){
	var doc = frameMap[id];
    $('head',doc).append($('<link>').attr('rel','stylesheet').attr('href','editor.css'));
	$('body',doc).append($("<h1>").addClass('header').html(id));
    var ta = $('<textarea>').keyup(render).blur(function(){
        $(this).fadeTo('slow',0.5);
        $('h1', frameMap[id]).fadeTo('slow',1);
    }).focus(function(){
        $(this).fadeTo('slow',1);
        $('h1', frameMap[id]).fadeTo('slow',0.2);
    }).blur();
	$('body',doc).append(ta);
	return ta;
}
var scriptLoaded = false;
function render(){
	var doc = frameMap[frameNames[targetFrameIndex]];
	// apply css, then html, then js...
	$('head style',doc).remove();
    $('head',doc).append($('<style>').html(taMap['css'].val()));
	$('body',doc).html(taMap['html'].val());
	if (scriptLoaded){
	    parent.frames['target'].eval(taMap['js'].val());
	} else {
	    var script = $('<script>').attr('type','text/javascript').attr('src',jqueryUrls[jqueryUrlIndex]).get(0);
	    script.onload = function(){
	        parent.frames['target'].eval(taMap['js'].val());
	    };
	    doc.head.appendChild(script);
	    scriptLoaded = true;
	}
};
</script></head><body/></html> 